<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced QR Code Attendance App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <style>
    /* Global Styles */
body {
    font-family: 'Poppins', sans-serif;
    background-color: #2AC1DC; /* Light gray background */
    color: #343a40; /* Dark text color */
}

/* Container Styles */
.container {
    margin-top: 30px;
    padding: 20px;
    background-color: #FCC868; /* White background for the container */
    border-radius: 20px; /* Rounded corners */
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); /* Subtle shadow */
}

/* Heading Styles */
h1 {
    color: #007; /* Bootstrap primary color */
    font-weight: bold;
}

/* Button Styles */
#download-pdf {
    background-color: #007bff; /* Bootstrap primary color */
    color: #ffffff; /* White text */
    border: none; /* Remove border */
    border-radius: 5px; /* Rounded corners */
    padding: 10px 20px; /* Padding for the button */
    font-size: 16px; /* Font size */
    cursor: pointer; /* Pointer cursor */
    transition: background-color 0.3s; /* Smooth background color transition */
}

/* Button Hover Effect */
#download-pdf:hover {
    background-color: #0056b3; /* Darker shade of blue on hover */
}

/* Table Styles */
.table {
    margin-top: 20px; /* Margin above the table */
    border-collapse: collapse; /* Remove gaps between cells */
}

/* Table Header Styles */
.table-dark {
    background-color: #343a40; /* Dark background for the header */
    color: white; /* White text for the header */
}

/* Table Row Styles */
.table-striped tbody tr:nth-of-type(odd) {
    background-color: #f2f2f2; /* Light gray for odd rows */
}

/* Modal Styles */
.modal-content {
    border-radius: 8px; /* Rounded corners for modal */
    animation: fadeIn 0.5s ease; /* Fade-in animation */
}

/* Keyframes for fade-in animation */
@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

/* Modal Icon Styles */
#modal-icon {
    font-size: 60px; /* Larger icon */
    color: #28a745; /* Green color for success */
}

/* Modal Text Styles */
#modal-body-text {
    font-size: 20px; /* Font size for modal text */
    margin-top: 10px; /* Space above text */
}

/* Responsive Styles */
@media (max-width: 768px) {
    h1 {
        font-size: 24px; /* Smaller heading on mobile */
    }

    #download-pdf {
        font-size: 14px; /* Smaller button text on mobile */
        padding: 8px 16px; /* Adjust padding on mobile */
    }

    #modal-icon {
        font-size: 50px; /* Smaller icon on mobile */
    }

    #modal-body-text {
        font-size: 18px; /* Smaller text on mobile */
    }
}
  </style>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container"> <br>
        <h1 align="center" style="font-size:35px"> Logic <br>Student QR Code Attendance</h1> <br> 
        <div class="section">
            <div id="my-qr-reader"></div>
            <button id="download-pdf">
                <i class="fas fa-download"></i> Download Attendance PDF
            </button>
            <button id="download-absent-pdf" class="mt-2">
    <i class="fas fa-download"></i> Download Absent Students PDF
</button>
            <table id="attendance-table" class="table table-striped table-bordered mt-3">
                <thead class="table-dark">
                    <tr>
                        <th>Serial No.</th>
                        <th>Name</th>
                        <th>Roll</th>
                        <th>Department</th>
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody id="attendance-body"></tbody>
            </table>
        </div>
    </div>

    <!-- Modal for QR Code Result -->
    <div class="modal fade" id="resultModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <i id="modal-icon" class="fas fa-check-circle animate-icon"></i>
                    <p id="modal-body-text" class="mt-3"></p>
                </div>
            </div>
        </div>
    </div>
    
<audio id="verified-sound" src="verified.mp3"></audio>
<audio id="warning-sound" src="warning.mp3"></audio>
<audio id="danger-sound" src="danger.mp3"></audio>


    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap 5 JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.20/jspdf.plugin.autotable.min.js"></script>
    <script>
      // List of students with their details (id, name, roll, department).
const students = [
    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },
    { id: "20240242", name: "Abid", roll: "102", department: "Arts" },
    { id: "20240243", name: "Sawon", roll: "103", department: "Commerce" },
    { id: "✔LUAPP~202401", name: "Mehekdi", roll: "105", department: "Science" },
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },   
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" }, 
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" }, 
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" }, 
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" }, 
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" }, 
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" }, 
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" }, 
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" }, 
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" }, 
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" }, 
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" }, 
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },
       { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },   
       { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
       { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
       { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" }, 
       { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" }, 
       { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
       { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" }, 
       { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" }, 
       { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" }, 
       { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" }, 
       { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
       { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },  
       { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },
];

// Load any previously saved attendance from Local Storage.
let attendance = JSON.parse(localStorage.getItem('attendance')) || [];

// Ensure DOM is fully loaded before running the code.
function domReady(fn) {
    if (document.readyState === "complete" || document.readyState === "interactive") {
        setTimeout(fn, 1000);
    } else {
        document.addEventListener("DOMContentLoaded", fn);
    }
}

// Execute code after DOM is ready.
domReady(function () {
    // Load the saved attendance records into the table.
    loadAttendance();

    // Called when a QR code is successfully scanned.
    function onScanSuccess(decodeText) {
        const student = students.find(s => s.id === decodeText);
        
        if (student) {
            // Check if the student is already marked present.
            if (!isStudentAlreadyPresent(student.id)) {
                const currentTime = new Date().toLocaleTimeString();
                attendance.push({ ...student, time: currentTime });
                localStorage.setItem('attendance', JSON.stringify(attendance));
                addAttendanceToTable(student, currentTime);
                showModal(`Verified: ${student.name} ✅`, "verified");
                textToSpeech(`Welcome, ${student.name}`);
            } else {
                // Show the same modal for already marked students
                showModal(`You are already marked present, ${student.name}.`, "info");
                textToSpeech(`Hello, ${student.name}. You are already marked present.`);
            }
        } else {
            showModal("Not Found: Invalid ID ❌", "danger");
            textToSpeech("Invalid ID scanned.");
        }
    }

    // Function to show a modal for 2 seconds and play sound based on the type.
    function showModal(message, type) {
        const modalBody = document.getElementById("modal-body-text");
        modalBody.innerHTML = message;

        // Set modal style based on the type (success, info, danger).
        const modalDialog = document.querySelector('.modal-dialog');
        modalDialog.className = `modal-dialog modal-${type}`;

        // Play the corresponding sound
        const sound = document.getElementById(`${type}-sound`);
        if (sound) {
            sound.currentTime = 0; // Reset sound to the beginning
            sound.play();
        }

        // Show modal and automatically hide it after 2 seconds.
        $('#resultModal').modal('show');
        setTimeout(() => $('#resultModal').modal('hide'), 4000);
    }

    // Function to check if a student is already marked present.
    function isStudentAlreadyPresent(id) {
        return attendance.some(entry => entry.id === id);
    }

    // Text-to-speech functionality
    function textToSpeech(message) {
        const speech = new SpeechSynthesisUtterance(message);
        speechSynthesis.speak(speech);
    }

    // Initialize the QR code scanner.
    let htmlscanner = new Html5QrcodeScanner("my-qr-reader", { fps: 10, qrbox: 250 });
    htmlscanner.render(onScanSuccess);

    // Button to download attendance records as PDF.
    document.getElementById("download-pdf").onclick = function () {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Add headers and the current date.
        doc.setFontSize(20);
        doc.text("Logic University", 105, 20, null, null, "center");
        doc.setFontSize(14);
        doc.text("Medical & Nursing Admission Private Program", 105, 30, null, null, "center");
        doc.setFontSize(12);
        doc.text("Developed by - Mehedi Al Hasan Sawon", 105, 40, null, null, "center");
        doc.setFontSize(10);
        doc.text(`Date: ${new Date().toLocaleDateString()}`, 10, 50);

        // Table headers.
        const startY = 60;
        doc.setFontSize(10);
        doc.text("Serial No.", 10, startY);
        doc.text("Name", 30, startY);
        doc.text("Roll", 80, startY);
        doc.text("Department", 100, startY);
        doc.text("Time", 140, startY);

        // Add attendance records.
        let y = startY + 10;
        attendance.forEach((entry, index) => {
            doc.text((index + 1).toString(), 10, y);
            doc.text(entry.name, 30, y);
            doc.text(entry.roll, 80, y);
            doc.text(entry.department, 100, y);
            doc.text(entry.time, 140, y);
            y += 10;
        });

        // Save the PDF.
        doc.save("attendance.pdf");
    };

    // Function to load saved attendance into the table.
    function loadAttendance() {
        const attendanceBody = document.getElementById("attendance-body");
        attendanceBody.innerHTML = ""; // Clear existing entries

        attendance.forEach((entry, index) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${index + 1}</td>
                <td>${entry.name}</td>
                <td>${entry.roll}</td>
                <td>${entry.department}</td>
                <td>${entry.time}</td>
            `;
            attendanceBody.appendChild(row);
        });
    }

    // Function to add a student entry to the attendance table.
    function addAttendanceToTable(student, time) {
        const attendanceBody = document.getElementById("attendance-body");
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${attendance.length + 1}</td>
            <td>${student.name}</td>
            <td>${student.roll}</td>
            <td>${student.department}</td>
            <td>${time}</td>
        `;
        attendanceBody.appendChild(row);
    }
});





document.getElementById("download-absent-pdf").onclick = function () {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const date = new Date();
    const formattedDate = `${date.getDate().toString().padStart(2, '0')}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getFullYear()}`;
    
    // Sample students data (use your actual data here)
    const students = [
        { name: "John Doe", roll: "101", department: "Science" },
        { name: "Jane Smith", roll: "102", department: "Arts" },
        { name: "Tom White", roll: "103", department: "Commerce" },
        // Add more student objects here...
    ];
    
    // Split students into two columns (left and right)
    const leftColumnData = students.slice(0, Math.ceil(students.length / 2));
    const rightColumnData = students.slice(Math.ceil(students.length / 2));
    
    // Define the table columns
    const columns = [
        { header: "Serial No.", dataKey: "serial" },
        { header: "Name", dataKey: "name" },
        { header: "Roll", dataKey: "roll" },
        { header: "Department", dataKey: "department" }
    ];

    // Prepare data for left column
    const leftTableData = leftColumnData.map((student, index) => ({
        serial: index + 1,
        name: student.name,
        roll: student.roll,
        department: student.department
    }));

    // Prepare data for right column
    const rightTableData = rightColumnData.map((student, index) => ({
        serial: index + leftColumnData.length + 1,
        name: student.name,
        roll: student.roll,
        department: student.department
    }));

    // Add a header to the PDF
    doc.setFontSize(16);
    doc.setTextColor(0, 0, 255);
    doc.text("Absent Students List", 105, 20, null, null, "center");

    // Add date to the PDF
    doc.setFontSize(12);
    doc.setTextColor(0, 0, 0);
    doc.text(`Date: ${formattedDate}`, 10, 30);

    // Add left table (first column)
    doc.autoTable({
        head: [columns],
        body: leftTableData,
        startY: 40,
        theme: 'grid',
        styles: { fontSize: 10, halign: 'center', textColor: 'blue' },
        columnStyles: {
            0: { halign: 'center' }, // Serial No.
            1: { halign: 'left' },   // Name
            2: { halign: 'center' }, // Roll
            3: { halign: 'center' }  // Department
        },
        tableWidth: 90,  // Width for left table
        margin: { left: 10 }  // Left margin
    });

    // Add right table (second column)
    doc.autoTable({
        head: [columns],
        body: rightTableData,
        startY: 40,
        theme: 'grid',
        styles: { fontSize: 10, halign: 'center', textColor: 'green' },
        columnStyles: {
            0: { halign: 'center' }, // Serial No.
            1: { halign: 'left' },   // Name
            2: { halign: 'center' }, // Roll
            3: { halign: 'center' }  // Department
        },
        tableWidth: 90,  // Width for right table
        margin: { left: 110 }  // Left margin for second column
    });

    // Save the PDF
    doc.save(`${formattedDate}-absent-students-list.pdf`);
};
    </script>
</body>
</html>