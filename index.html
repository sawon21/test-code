<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced QR Code Attendance App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <style>
    /* Global Styles */
body {
    font-family: 'Poppins', sans-serif;
    background-color: #2AC1DC; /* Light gray background */
    color: #343a40; /* Dark text color */
}

/* Container Styles */
.container {
    margin-top: 30px;
    padding: 20px;
    background-color: #FCC868; /* White background for the container */
    border-radius: 20px; /* Rounded corners */
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); /* Subtle shadow */
}

/* Heading Styles */
h1 {
    color: #007; /* Bootstrap primary color */
    font-weight: bold;
}

/* Button Styles */
#download-pdf {
    background-color: #007bff; /* Bootstrap primary color */
    color: #ffffff; /* White text */
    border: none; /* Remove border */
    border-radius: 5px; /* Rounded corners */
    padding: 10px 20px; /* Padding for the button */
    font-size: 16px; /* Font size */
    cursor: pointer; /* Pointer cursor */
    transition: background-color 0.3s; /* Smooth background color transition */
}

/* Button Hover Effect */
#download-pdf:hover {
    background-color: #0056b3; /* Darker shade of blue on hover */
}

/* Table Styles */
.table {
    margin-top: 20px; /* Margin above the table */
    border-collapse: collapse; /* Remove gaps between cells */
}

/* Table Header Styles */
.table-dark {
    background-color: #343a40; /* Dark background for the header */
    color: white; /* White text for the header */
}

/* Table Row Styles */
.table-striped tbody tr:nth-of-type(odd) {
    background-color: #f2f2f2; /* Light gray for odd rows */
}

/* Modal Styles */
.modal-content {
    border-radius: 8px; /* Rounded corners for modal */
    animation: fadeIn 0.5s ease; /* Fade-in animation */
}

/* Keyframes for fade-in animation */
@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

/* Modal Icon Styles */
#modal-icon {
    font-size: 60px; /* Larger icon */
    color: #28a745; /* Green color for success */
}

/* Modal Text Styles */
#modal-body-text {
    font-size: 20px; /* Font size for modal text */
    margin-top: 10px; /* Space above text */
}

/* Responsive Styles */
@media (max-width: 768px) {
    h1 {
        font-size: 24px; /* Smaller heading on mobile */
    }

    #download-pdf {
        font-size: 14px; /* Smaller button text on mobile */
        padding: 8px 16px; /* Adjust padding on mobile */
    }

    #modal-icon {
        font-size: 50px; /* Smaller icon on mobile */
    }

    #modal-body-text {
        font-size: 18px; /* Smaller text on mobile */
    }
}
  </style>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container"> <br>
        <h1 align="center" style="font-size:35px"> Logic <br>Student QR Code Attendance</h1> <br> 
        <div class="section">
            <div id="my-qr-reader"></div>
            <button id="download-pdf">
                <i class="fas fa-download"></i> Download Attendance PDF
            </button>
            <button id="download-absent-pdf" class="mt-2">
    <i class="fas fa-download"></i> Download Absent Students PDF
</button>
            <table id="attendance-table" class="table table-striped table-bordered mt-3">
                <thead class="table-dark">
                    <tr>
                        <th>Serial No.</th>
                        <th>Name</th>
                        <th>Roll</th>
                        <th>Department</th>
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody id="attendance-body"></tbody>
            </table>
        </div>
    </div>

    <!-- Modal for QR Code Result -->
    <div class="modal fade" id="resultModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <i id="modal-icon" class="fas fa-check-circle animate-icon"></i>
                    <p id="modal-body-text" class="mt-3"></p>
                </div>
            </div>
        </div>
    </div>
    
<audio id="verified-sound" src="verified.mp3"></audio>
<audio id="warning-sound" src="warning.mp3"></audio>
<audio id="danger-sound" src="danger.mp3"></audio>


    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap 5 JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
      // List of students with their details (id, name, roll, department).
const students = [
    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },
    { id: "20240242", name: "Abid", roll: "102", department: "Arts" },
    { id: "20240243", name: "Sawon", roll: "103", department: "Commerce" },
    { id: "✔LUAPP~202401", name: "Mehekdi", roll: "105", department: "Science" },
        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },        { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },
       { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },    { id: "✔LUAPP~20240101", name: "Mehedi", roll: "101", department: "Science" },
];

// Load any previously saved attendance from Local Storage.
let attendance = JSON.parse(localStorage.getItem('attendance')) || [];

// Ensure DOM is fully loaded before running the code.
function domReady(fn) {
    if (document.readyState === "complete" || document.readyState === "interactive") {
        setTimeout(fn, 1000);
    } else {
        document.addEventListener("DOMContentLoaded", fn);
    }
}

// Execute code after DOM is ready.
domReady(function () {
    // Load the saved attendance records into the table.
    loadAttendance();

    // Called when a QR code is successfully scanned.
    function onScanSuccess(decodeText) {
        const student = students.find(s => s.id === decodeText);
        
        if (student) {
            // Check if the student is already marked present.
            if (!isStudentAlreadyPresent(student.id)) {
                const currentTime = new Date().toLocaleTimeString();
                attendance.push({ ...student, time: currentTime });
                localStorage.setItem('attendance', JSON.stringify(attendance));
                addAttendanceToTable(student, currentTime);
                showModal(`Verified: ${student.name} ✅`, "verified");
                textToSpeech(`Welcome, ${student.name}`);
            } else {
                // Show the same modal for already marked students
                showModal(`You are already marked present, ${student.name}.`, "info");
                textToSpeech(`Hello, ${student.name}. You are already marked present.`);
            }
        } else {
            showModal("Not Found: Invalid ID ❌", "danger");
            textToSpeech("Invalid ID scanned.");
        }
    }

    // Function to show a modal for 2 seconds and play sound based on the type.
    function showModal(message, type) {
        const modalBody = document.getElementById("modal-body-text");
        modalBody.innerHTML = message;

        // Set modal style based on the type (success, info, danger).
        const modalDialog = document.querySelector('.modal-dialog');
        modalDialog.className = `modal-dialog modal-${type}`;

        // Play the corresponding sound
        const sound = document.getElementById(`${type}-sound`);
        if (sound) {
            sound.currentTime = 0; // Reset sound to the beginning
            sound.play();
        }

        // Show modal and automatically hide it after 2 seconds.
        $('#resultModal').modal('show');
        setTimeout(() => $('#resultModal').modal('hide'), 4000);
    }

    // Function to check if a student is already marked present.
    function isStudentAlreadyPresent(id) {
        return attendance.some(entry => entry.id === id);
    }

    // Text-to-speech functionality
    function textToSpeech(message) {
        const speech = new SpeechSynthesisUtterance(message);
        speechSynthesis.speak(speech);
    }

    // Initialize the QR code scanner.
    let htmlscanner = new Html5QrcodeScanner("my-qr-reader", { fps: 10, qrbox: 250 });
    htmlscanner.render(onScanSuccess);

    // Button to download attendance records as PDF.
    document.getElementById("download-pdf").onclick = function () {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Add headers and the current date.
        doc.setFontSize(20);
        doc.text("Logic University", 105, 20, null, null, "center");
        doc.setFontSize(14);
        doc.text("Medical & Nursing Admission Private Program", 105, 30, null, null, "center");
        doc.setFontSize(12);
        doc.text("Developed by - Mehedi Al Hasan Sawon", 105, 40, null, null, "center");
        doc.setFontSize(10);
        doc.text(`Date: ${new Date().toLocaleDateString()}`, 10, 50);

        // Table headers.
        const startY = 60;
        doc.setFontSize(10);
        doc.text("Serial No.", 10, startY);
        doc.text("Name", 30, startY);
        doc.text("Roll", 80, startY);
        doc.text("Department", 100, startY);
        doc.text("Time", 140, startY);

        // Add attendance records.
        let y = startY + 10;
        attendance.forEach((entry, index) => {
            doc.text((index + 1).toString(), 10, y);
            doc.text(entry.name, 30, y);
            doc.text(entry.roll, 80, y);
            doc.text(entry.department, 100, y);
            doc.text(entry.time, 140, y);
            y += 10;
        });

        // Save the PDF.
        doc.save("attendance.pdf");
    };

    // Function to load saved attendance into the table.
    function loadAttendance() {
        const attendanceBody = document.getElementById("attendance-body");
        attendanceBody.innerHTML = ""; // Clear existing entries

        attendance.forEach((entry, index) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${index + 1}</td>
                <td>${entry.name}</td>
                <td>${entry.roll}</td>
                <td>${entry.department}</td>
                <td>${entry.time}</td>
            `;
            attendanceBody.appendChild(row);
        });
    }

    // Function to add a student entry to the attendance table.
    function addAttendanceToTable(student, time) {
        const attendanceBody = document.getElementById("attendance-body");
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${attendance.length + 1}</td>
            <td>${student.name}</td>
            <td>${student.roll}</td>
            <td>${student.department}</td>
            <td>${time}</td>
        `;
        attendanceBody.appendChild(row);
    }
});





// Button to download absent students as a colorful, book-style PDF
document.getElementById("download-absent-pdf").onclick = function () {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    // Get the current date for naming the file
    const date = new Date();
    const formattedDate = `${date.getDate().toString().padStart(2, '0')}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getFullYear()}`;

    // Styling for headers, rows, and fonts
    const headerBackground = [41, 128, 185];  // Blue for header background
    const rowAlternatingColors = [[236, 240, 241], [255, 255, 255]];  // Light gray and white for alternating rows
    const headerTextColor = [255, 255, 255];  // White text for headers
    const contentTextColor = [0, 0, 0];  // Black text for content
    const footerBackground = [52, 73, 94];  // Dark background for footer
    const fontType = "courier";  // Stylish font for all text
    const leftTableStartX = 10;
    const rightTableStartX = 110;  // Adjusted for two columns
    const tableStartY = 65;
    
    // Custom header styling
    function drawHeader(doc) {
        doc.setFillColor(...headerBackground);
        doc.rect(0, 10, 210, 20, 'F');  // Header background

        doc.setFontSize(20);
        doc.setFont(fontType, "bold");
        doc.setTextColor(...headerTextColor);
        doc.text("Logic University", 105, 25, null, null, "center");

        doc.setFontSize(14);
        doc.text("Medical & Nursing Admission Private Program", 105, 33, null, null, "center");

        // Developer Info
        doc.setFontSize(12);
        doc.setTextColor(contentTextColor);
        doc.text("Developed by - Mehedi Al Hasan Sawon", 105, 45, null, null, "center");

        // Add date
        doc.setFontSize(10);
        doc.text(`Date: ${formattedDate}`, 10, 55);
    }

    // Custom footer styling
    function drawFooter(doc) {
        doc.setFillColor(...footerBackground);
        doc.rect(0, 285, 210, 10, 'F');  // Footer background
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(8);
        doc.text("Generated by Logic University Attendance System", 105, 290, null, null, "center");
    }

    // Draws one page of the book-style table
    function drawTablePage(doc, students, startIndex) {
        drawHeader(doc);  // Add header

        const headers = ["Serial No.", "Name", "Roll", "Department"];
        const headerXPositionsLeft = [10, 30, 80, 130];
        const headerXPositionsRight = [110, 130, 180, 230];

        // Draw table headers for both left and right tables
        doc.setFont(fontType, "bold");
        doc.setFillColor(...headerBackground);
        doc.setTextColor(...headerTextColor);

        doc.rect(leftTableStartX, tableStartY - 5, 90, 10, 'F');  // Header background for left table
        headers.forEach((header, i) => {
            doc.text(header, headerXPositionsLeft[i], tableStartY);
        });

        doc.rect(rightTableStartX, tableStartY - 5, 90, 10, 'F');  // Header background for right table
        headers.forEach((header, i) => {
            doc.text(header, headerXPositionsRight[i], tableStartY);
        });

        let yLeft = tableStartY + 10;  // Start position for left table rows
        let yRight = tableStartY + 10;  // Start position for right table rows
        let studentsPerSide = Math.floor(students.length / 2);
        let leftStudents = students.slice(0, studentsPerSide);
        let rightStudents = students.slice(studentsPerSide);

        // Draw left table
        leftStudents.forEach((student, index) => {
            const rowColor = rowAlternatingColors[index % 2];
            doc.setFillColor(...rowColor);
            doc.rect(leftTableStartX, yLeft - 5, 90, 10, 'F');  // Filled rectangle for left rows

            doc.setTextColor(contentTextColor);
            doc.setFont(fontType, "normal");
            doc.text((startIndex + index + 1).toString(), headerXPositionsLeft[0], yLeft);
            doc.text(student.name, headerXPositionsLeft[1], yLeft);
            doc.text(student.roll, headerXPositionsLeft[2], yLeft);
            doc.text(student.department, headerXPositionsLeft[3], yLeft);

            yLeft += 10;
        });

        // Draw right table
        rightStudents.forEach((student, index) => {
            const rowColor = rowAlternatingColors[index % 2];
            doc.setFillColor(...rowColor);
            doc.rect(rightTableStartX, yRight - 5, 90, 10, 'F');  // Filled rectangle for right rows

            doc.setTextColor(contentTextColor);
            doc.setFont(fontType, "normal");
            doc.text((startIndex + studentsPerSide + index + 1).toString(), headerXPositionsRight[0], yRight);
            doc.text(student.name, headerXPositionsRight[1], yRight);
            doc.text(student.roll, headerXPositionsRight[2], yRight);
            doc.text(student.department, headerXPositionsRight[3], yRight);

            yRight += 10;
        });

        drawFooter(doc);  // Add footer
    }

    // Fetch absent students and generate the PDF
    const absentStudents = students.filter(student => !isStudentAlreadyPresent(student.id));
    const studentsPerPage = 40;  // 20 per side (two tables on each page)
    
    let currentPage = 0;
    while (currentPage * studentsPerPage < absentStudents.length) {
        if (currentPage > 0) doc.addPage();  // Add a new page if needed
        const pageStudents = absentStudents.slice(currentPage * studentsPerPage, (currentPage + 1) * studentsPerPage);
        drawTablePage(doc, pageStudents, currentPage * studentsPerPage);
        currentPage++;
    }

    // Save the PDF with a dynamic name
    doc.save(`${formattedDate}-absent-students-list.pdf`);
};

// Function to check if a student is already marked present
function isStudentAlreadyPresent(id) {
    return attendance.some(entry => entry.id === id);
}
    </script>
</body>
</html>